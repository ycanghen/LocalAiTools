# AI 聊天程序 - PySide6 优雅版

这是一个使用 PySide6 构建的桌面 AI 聊天应用程序，旨在提供一个直观的界面，用于与各种 AI 模型进行交互，并管理您的对话历史。

---

## 功能特性

* **直观的聊天界面**: 清晰的聊天显示区域和用户输入框，提供流畅的对话体验。
* **会话管理**:
    * **新建对话**: 轻松开启一个全新的聊天会话。
    * **保存对话**: 将当前对话内容（包括 API 配置和消息历史）保存为 JSON 文件，方便后续加载。
    * **加载历史**: 侧边栏列出所有保存的会话文件，点击即可加载并继续之前的对话。
* **API 配置**: 允许用户在界面上输入 **API 地址** 和 **API Key**。
* **模型选择**: 通过下拉菜单选择不同的 AI 模型，并支持点击 **“刷新模型”** 按钮从 API 端点动态获取可用的模型列表。
* **图片上传**: 支持将图片作为 Base64 编码的附件与文本消息一并发送给支持图像输入的多模态模型（例如 `gpt-4o`）。
* **全局 Prompt (角色设定)**: 在独立设置窗口中，您可以定义一个全局的 AI 角色设定（Prompt），该设定将在每次对话开始时应用于 AI。
* **API Key 显示/隐藏**: 为了安全性，API Key 输入框支持密码模式和普通文本模式切换。
* **智能消息显示**: 根据消息来源（用户、AI 或系统），使用不同的颜色和样式进行区分，提高可读性。

---

## 技术栈

* **Python**: 后端逻辑和应用程序的核心语言。
* **PySide6**: 用于构建图形用户界面 (GUI)。
* **`requests`**: 用于向 AI 模型的 API 发送 HTTP 请求。
* **`threading`**: 在后台线程中执行 API 调用，避免 UI 阻塞。

---

## 运行项目

请按照以下步骤在您的本地环境中运行此应用程序：

1.  **克隆或下载项目**:
    将项目代码下载到您的本地机器。

2.  **安装依赖**:
    打开终端或命令提示符，导航到项目目录，然后运行以下命令安装所需的 Python 库：

    ```bash
    pip install PySide6 requests
    ```

3.  **创建会话目录**:
    程序会将所有聊天会话保存到 `D:/joy/HistoryAi` 目录。请确保此目录存在，或者您可以修改代码中 `SESSION_DIR` 变量的值为您系统上合适的路径。

    ```python
    SESSION_DIR = "D:/joy/HistoryAi" # 您可以根据需要修改此路径
    ```

4.  **运行应用程序**:
    在终端或命令提示符中，导航到包含 `chat_app.py`（假设您将代码保存为此文件名）的目录，然后运行：

    ```bash
    python chat_app.py
    ```

---

## 使用指南

1.  **启动应用**: 运行 `chat_app.py` 后，主聊天窗口将显示。
2.  **配置 API**:
    * 在顶部的输入框中输入您的 **AI API 地址** (例如：`https://api.openai.com/v1/chat/completions`)。
    * 输入您的 **API Key**。您可以点击 **“显示 Key”** 按钮来查看或隐藏输入内容。
    * 点击 **“刷新模型”** 按钮，应用程序将尝试从您提供的 API 地址获取并填充可用的模型列表。
3.  **设置全局 Prompt (可选)**:
    * 点击 **“设置”** 按钮，打开设置窗口。
    * 在 **“全局 Prompt（角色设定）”** 输入框中，输入您希望 AI 扮演的角色或遵循的指令 (例如：“你是一个有趣的历史老师”)。
    * 点击 **“保存设置”** 关闭窗口。
4.  **开始聊天**:
    * 在底部的输入框中输入您的消息。
    * 如果需要发送图片，点击 **“上传图片”** 按钮选择图片文件。请注意，只有支持图片输入的多模态模型才能处理图片消息。
    * 点击 **“发送”** 按钮或按回车键发送消息。
5.  **保存与加载会话**:
    * 点击 **“保存对话”** 按钮，可以将当前对话保存为一个 JSON 文件。如果是新对话，会提示您选择保存路径和文件名；如果已经加载了会话，则直接保存到当前文件。
    * 左侧的 **“历史会话”** 列表中会显示所有已保存的会话文件。点击列表中的文件名即可加载该会话，继续之前的对话。
6.  **新建对话**: 点击 **“新建对话”** 按钮将清除当前聊天内容，开始一个新的会话。


---

## 截图

<img width="933" height="670" alt="image" src="https://github.com/user-attachments/assets/7be05abb-e453-40df-aa98-0f0f35ebe6d1" />

<img width="926" height="649" alt="image" src="https://github.com/user-attachments/assets/5ac41f09-9071-4ace-a76e-14b1fd62cdcc" />


